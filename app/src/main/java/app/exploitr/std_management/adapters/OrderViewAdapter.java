package app.exploitr.std_management.adapters;

import android.annotation.SuppressLint;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.appcompat.widget.AppCompatSpinner;
import androidx.recyclerview.widget.RecyclerView;

import com.google.android.material.button.MaterialButton;
import com.ms.square.android.expandabletextview.ExpandableTextView;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Locale;
import java.util.Set;

import app.exploitr.storetodoor.Objects.OrderObject;
import app.exploitr.storetodoor.R;
import app.exploitr.storetodoor.functions.majors.DatabaseConstants;

public class OrderViewAdapter extends RecyclerView.Adapter<OrderViewAdapter.OrderListHolder> {

	Set<OrderObject> mData;
	confirmListener mListener;
	Calendar calendar;

	public OrderViewAdapter(Set<OrderObject> data, confirmListener listener) {
		mData = data;
		mListener = listener;

		calendar = Calendar.getInstance();
	}

	@NonNull
	@Override
	public OrderViewAdapter.OrderListHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
		return new OrderListHolder(LayoutInflater.from(parent.getContext()).inflate(R.layout.recycler_admin_order_list_items, parent, false));
	}

	@SuppressLint("SetTextI18n")
	@Override
	public void onBindViewHolder(@NonNull OrderViewAdapter.OrderListHolder holder, int position) {
		OrderObject current = mData.toArray(new OrderObject[0])[position];

		holder.order_id_text_admin.setText(String.valueOf(current.getTime()));

		calendar.setTimeInMillis(current.getTime());
		SimpleDateFormat format = new SimpleDateFormat("E, dd MMM yyyy HH:mm:ss", Locale.getDefault());
		format.setCalendar(calendar);
		holder.order_time_text_admin.setText(new StringBuilder("Ordered on " + format.format(calendar.getTime())));

		holder.order_address_text_admin.setText(current.getAddress());

		holder.payment_mode_text_admin.setText(current.getPayment_mode() == DatabaseConstants.PAYMENT_MODE_G_PAY ? "Payment : Google Pay" : "Payment : Cash On");

		holder.phone_address_text_admin.setText(current.getPhone_number());
		holder.total_price_admin.setText("â‚¹ " + (current.getTotal_price() + current.getDelivery_charge()));

		holder.set_status_admin.setSelection((int) current.getOrder_state(), true);

		StringBuilder all_foods = new StringBuilder();
		for (OrderObject.ItemOrder order : current.getFoods()) {
			all_foods.append(order.item).append(" : ").append(order.count).append("\n");
		}
		holder.orderDesc_admin.setText("Foods : " + all_foods.toString());

		holder.order_confirm_admin.setOnClickListener(v -> mListener.confirm(position, current,
				holder.set_status_admin.getSelectedItemPosition()));
	}

	@Override
	public int getItemCount() {
		return mData.size();
	}

	public static class OrderListHolder extends RecyclerView.ViewHolder {
		TextView order_id_text_admin,
				order_time_text_admin,
				order_address_text_admin,
				payment_mode_text_admin,
				phone_address_text_admin,
				total_price_admin;

		ExpandableTextView orderDesc_admin;

		AppCompatSpinner set_status_admin;
		MaterialButton order_confirm_admin;

		public OrderListHolder(@NonNull View itemView) {
			super(itemView);
			order_id_text_admin = itemView.findViewById(R.id.order_id_text_admin);
			order_time_text_admin = itemView.findViewById(R.id.order_time_text_admin);
			order_address_text_admin = itemView.findViewById(R.id.order_address_text_admin);
			payment_mode_text_admin = itemView.findViewById(R.id.payment_mode_text_admin);
			phone_address_text_admin = itemView.findViewById(R.id.phone_address_text_admin);
			total_price_admin = itemView.findViewById(R.id.total_price_admin);
			orderDesc_admin = itemView.findViewById(R.id.orderDesc_admin);

			set_status_admin = itemView.findViewById(R.id.set_status_admin);
			order_confirm_admin = itemView.findViewById(R.id.order_confirm_admin);
		}
	}

	public interface confirmListener {
		void confirm(int pos, OrderObject data, int status);
	}
}
