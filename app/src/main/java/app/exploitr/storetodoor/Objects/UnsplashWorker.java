package app.exploitr.storetodoor.Objects;

import android.content.Context;

import org.json.JSONArray;
import org.json.JSONObject;

import java.io.IOException;

import okhttp3.Call;
import okhttp3.Callback;
import okhttp3.HttpUrl;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;

public class UnsplashWorker {
	public static void getImageLink(Context context, String query, UnsplashListener listener) {
		OkHttpClient client = new OkHttpClient();

		//https://api.unsplash.com/search/photos?
		// client_id=al9wfZ3aoYhnqOCSouXGWswDgdgbE7nzOajTi1LW4UI
		// &page=1
		// &query=biryani
		// &orientation=landscape
		// &content_filter=high

		HttpUrl.Builder urlBuilder = HttpUrl.parse("https://api.unsplash.com/search/photos?")
				.newBuilder();
	//	urlBuilder.addQueryParameter("client_id", LocalDatabase.getInstance(context).getUSP_A());
		urlBuilder.addQueryParameter("page", "1");
		urlBuilder.addQueryParameter("query", query);
		urlBuilder.addQueryParameter("orientation", "landscape");
		urlBuilder.addQueryParameter("content_filter", "high");
		String url = urlBuilder.build().toString();

		Request request = new Request.Builder()
				.url(url)
				.addHeader("Accept-Version", "v1")
				.build();

		client.newCall(request).enqueue(new Callback() {
			@Override
			public void onFailure(Call call, IOException e) {
				listener.onFailure(e);
			}

			@Override
			public void onResponse(Call call, Response response) {
				try {
					JSONObject object = new JSONObject(response.body().string());
					JSONArray array = object.getJSONArray("results");

					JSONObject select = array.getJSONObject(0);
					JSONObject urls = select.getJSONObject("urls");

					String url = urls.getString("thumb");

					listener.onSuccess(url);
				} catch (Exception e) {
					listener.onFailure(e);
				}
			}
		});
	}

	public interface UnsplashListener {
		void onFailure(Exception e);

		void onSuccess(String url);
	}
}
